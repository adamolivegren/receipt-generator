<!DOCTYPE html>
<html>
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Document</title>
      <script
        src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
        integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
      ></script>
      <style>
        @page {
          size: A4;
        }
      </style>
    </head>
    <body id="element-to-print">
      <form id="form">
        <input type="file" id="file" accept=".csv" />
        <br />
        <input type="submit" value="Submit" />
      </form>
      <button onclick="convert()">HEJ</button>
      <script>
        // TODO: Skapa loop fÃ¶r samtliga element i array
        // TODO: i loopen ska varje dokument exporteras till pdf

        // get data from csv file
        getData().then((data) => {
          console.log(data);
        });

        // PDF export
        var element = document.getElementById("element-to-print");
        const convert = () => {
          html2pdf(element);
        };

        async function getData() {
          // Fetch the contents of the CSV file
          const response = await fetch("kvitton.csv");

          // Get the contents of the file as a string
          const csvString = await response.text();

          // Split the string into an array of lines
          const lines = csvString.split("\n");

          // Get the headers (first line of the CSV)
          const headers = lines[0].split(",");

          // Convert the remaining lines to an array of objects
          const data = lines.slice(1).map((line) => {
            // Split the line into an array of values
            const values = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);

            // Reduce the array of values to an object
            return values.reduce((obj, value, i) => {
              obj[headers[i]] = value;
              return obj;
            }, {});
          });

          return data;
        }
      </script>
    </body>
  </html>
</html>
