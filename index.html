<!DOCTYPE html>
<html>
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Document</title>

      <style>
        @page {
          size: A4;
        }
      </style>
    </head>
    <body id="element-to-print">
      <form id="form">
        <input type="file" id="file" accept=".csv" />
        <br />
        <input type="submit" value="Submit" />
      </form>
      <button onclick="convert()">Convert</button>
      <script>
        // TODO: Skapa loop fÃ¶r samtliga element i array
        // TODO: i loopen ska varje dokument exporteras till pdf

        // get data from csv file
        getData().then((data) => {
          console.log(data[0]);
          // TODO: Add querys
          let url = "receipt.html?";
          const id = data[0].receiptId;
          const date = data[0].Datum;
          const address = data[0].Adress;
          const quantity = data[0].Antal;
          const company = data[0].Company;
          const moms = data[0].Moms;
          const momsNo = data[0].MomsNo;
          const momsSats = data[0].Momssats;
          const orgNo = data[0].OrgNo;
          const price = data[0].Pris;
          const item = data[0].Product;
          const time = data[0].Tid;
          url += `id=${id}&date=${date}&address=${address}`;
          console.log(url);
          window.location.href = url;
        });

        async function getData() {
          // Fetch the contents of the CSV file
          const response = await fetch("kvitton.csv");

          // Get the contents of the file as a string
          const csvString = await response.text();

          // Split the string into an array of lines
          const lines = csvString.split("\n");

          // Get the headers (first line of the CSV)
          const headers = lines[0].split(",");

          // Convert the remaining lines to an array of objects
          const data = lines.slice(1).map((line) => {
            // Split the line into an array of values
            const values = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);

            // Reduce the array of values to an object
            return values.reduce((obj, value, i) => {
              obj[headers[i]] = value;
              return obj;
            }, {});
          });

          return data;
        }
      </script>
    </body>
  </html>
</html>
